<?phpnamespace controller;use model\cartModel;use model\productModel;include_once '../model/cartModel.php';include_once '../model/productModel.php';class cartController{    public function addCart()    {        $productName = $_POST['ProductName'];        $image = $_POST['image'];        $price = $_POST['price'];        $quantity = $_POST['quantity'];        $productId = $_POST['ProductId'];        $userId = $_POST['userId'];        $checker = new productModel();        $model = new cartModel();        // First, check stock before proceeding        if ($checker->stacksChecker($productId, $quantity)) {            // If stacksChecker returns true (insufficient stock), return an error response            echo json_encode(['success' => false, 'message' => "Insufficient stock available."]);            exit;        }        // If stock is sufficient, proceed with adding to the cart        $model->AddCart($productName, $price, $image, $quantity, $productId, $userId);        exit;    }    public function DisplayCart($userId)    {        $model = new cartModel();        $data = $model->displayCartProduct($userId);        if ($data) {            $tr = '';            $totalPrice = 0; // Initialize total price            foreach ($data as $row) {                $name = $row['ProductName'];                $id = $row['id'];                $price = $row['price'];                $quantity = $row['Quantity'];                $image = $row['image'];                // Calculate the total price for each item                $itemTotal = $price * $quantity;                $totalPrice += $itemTotal; // Add the item total to the overall total price                $tr .= '          <tr>            <td>              <img style="height: 30px; width: 30px; object-fit: cover" class="card-img rounded-circle" src="../../ProductImages/' . $image . '" alt="image">            </td>            <td>' . $name . '</td>            <td>' . $quantity . '</td>            <td>₱' . $price . '</td>            <td>₱' . $itemTotal . '</td>             <td>              <button id="btn_remove" value="'.$id.'" class="btn badge text-danger">                remove                <i  class="fa-solid fa-trash-can"></i>              </button>            </td>          </tr>        ';            }            $tr .= '        <tr>          <td colspan="4" style="text-align:right"><strong>Total Price:</strong></td>          <td><strong>₱'. $_SESSION['Total'] = number_format($totalPrice) . '</strong></td>        </tr>      ';            echo $tr;        } else {            echo "<h5>Empty Cart</h5>";        }    }    public function removeFromCart()    {        $cartId = $_POST['cartId'];        $model = new cartModel();        if (isset($cartId)){            $model->removeFromCart($cartId);        }else{            echo "No cartId";        }    }    public function orders($userId)    {        $model = new cartModel();        $data = $model->displayCartProduct($userId);        $card = '<div>';        $card .= '    <div class="form-floating mb-3">        <input name="address" value="' . $_SESSION['Address'] . '" type="text" class="form-control" id="floatingInput" placeholder="name@example.com">        <label for="floatingInput">Address</label>    </div>    <input name="costumerName" type="hidden" value="' . $_SESSION['Name'] . '">    <input name="Phone" type="hidden" value="' . $_SESSION['phone'] . '">    <input name="userId" type="hidden" value="' . $_SESSION['userId'] . '">    <input name="Email" type="hidden" value="' . $_SESSION['username'] . '">    ';        if ($data) {            $total = 0; // Initialize total variable            foreach ($data as $row) {                $productName = $row['ProductName'];                $image = $row['image'];                $quantity = $row['Quantity'];                $price = $row['price'];                $itemTotal = $price * $quantity; // Calculate item total                $total += $itemTotal; // Add to overall total                $productId = $row['ProductId'];                $card .= '                        <div class="d-flex gap-2 justify-content-center align-items-center mb-2">                            <img style="height: 30px; width: 30px; object-fit: cover" class="card-img rounded-circle" src="../../ProductImages/' . $image . '" alt="image">                                                    <label>                            Product Name                            <input disabled class="form-control" value="' . $productName . '">                            <input name="productName[]" type="hidden" class="form-control" value="' . $productName . '">                            <input name="itemTotal[]" type="hidden" class="form-control" value="' . $itemTotal . '">                            </label>                                                    <label>                            Quantity                            <input disabled class="form-control" value="' . $quantity . '">                            <input name="productId[]" type="hidden" class="form-control" value="' . $productId . '">                            <input name="quantity[]" type="hidden" class="form-control" value="' . $quantity . '">                            </label>                                                    <label>                            Price                            <input disabled class="form-control" value="' . $price . '">                            <input name="price[]" type="hidden" class="form-control" value="' . $price . '">                            </label>                        </div>                        ';            }            // Display total after the product list            $card .= '        <div class="mt-3">            <span class="fw-bold">Total: ' . number_format($total, 2) . '</span>            <input name="Total" type="hidden" class="form-control" value="' . $total . '">        </div>    ';            $card .= '</div>'; // Close main div            echo $card;        } else {            echo $card;            echo "<h2>No Order Available</h2>";        }    }}// Handle POST requestsif ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['action'])) {    $cart = new cartController();    switch ($_POST['action']) {        case 'AddCart':            $cart->addCart();            break;        case 'Remove':            $cart->removeFromCart();            break;    }}