<?phpnamespace controller;use model\productModel;include_once __DIR__ . '/../model/productModel.php';class productController{  public function HandleAddProducts()  {      $model = new productModel();      $productName = $_POST['ProductName'];      $price = $_POST['unitPrice'];      $image = $_FILES['image'];      $category = $_POST['category'];      $Stack = $_POST['Stack'];      // validation      $data = [];      $error = [];      if (empty($productName)){          $error['ErrorMessage'] = 'product name is required';      }      if (empty($price)){          $error['ErrorMessage'] = 'price name is required';      }      if (empty($image['name'])){          $error['ErrorMessage'] = 'image name is required';      }     if (empty($category)){          $error['ErrorMessage'] = 'category is required';      }      if (empty($Stack)){          $error['ErrorMessage'] = 'Stack is required';      }      if (!empty($error)){          $data['success'] = false;          $data['error'] = $error;          echo json_encode($data);      }else{          $fileName = $_FILES['image']['name'];          // Set file directory and path          $fileDir = '../../ProductImages/';          $filePath = $fileDir . $fileName;          move_uploaded_file($image['tmp_name'], $filePath);          $model->addProducts($productName,$price,$fileName,$category,$Stack);      }  }  public function displayProduct()  {      $tr = '';      $model = new productModel();      $data = $model->displayProducts();      if ($data){          foreach ($data as $row){              $productName = $row['ProductName'];              $price = $row['Price'];              $image = $row['image'];              $productId = $row['product_Id'];              $tr .= '             <tr>              <th>'.$productId.'</th>              <td>               <img style="height: 50px; width: 50px" class="img-thumbnail rounded-circle" src="../../ProductImages/'.$image.'" alt="image">              </td>               <th>'.$productName.'</th>              <td>'.$price.'</td>              <td>              <button id="btn_update" value="'.$productId.'" class="btn btn-outline-primary">Edit</button>              <button id="btn_archive" value="'.$productId.'"  class="btn btn-outline-danger">Archive</button>               </td>             </tr>          ';          }          echo $tr;      }else{          echo "<h1>No Product Available</h1>";      }  }  public function DisplayToStore()  {      $card = '';      $model = new productModel();      $data = $model->displayProducts();      if ($data){          foreach ($data as $row){              $productName = $row['ProductName'];              $price = $row['Price'];              $image = $row['image'];              $productId = $row['product_Id'];              $card .= '                  <form id="cart_form" action="../controller/cartController.php" method="post" class="card border-3 border-black col-lg-3 col-md-7 p-2">                   <img style="height: 30vh; object-fit: cover" class="card-img" src="../../ProductImages/'.$image.'" alt="image">                 <div class="card-body d-flex flex-column gap-2">                  <h5 class="card-title fw-bold">'.$productName.'</h5>                   <label for="quantity">                   <input name="quantity" min="1" class="form-control" type="number" value="1" placeholder="Quantity">                 </label>                   <input name="price" type="hidden" value="'.$price.'">                  <input name="image" type="hidden" value="'.$image.'">                  <input name="ProductName"  type="hidden" value="'.$productName.'">                  <input name="ProductId"  type="hidden" value="'.$productId.'">                  <input name="userId" type="hidden" value="'.$_SESSION['userId'].'">                               <h5 class="">₱'.$price.'</h5>            <button value="'.$productId.'" type="submit" class="btn btn-outline-primary">Add Cart</button>        </div>    </form>              ';          }          echo $card;      }  }  public function updateProduct()  {      $id = $_POST['id'];      $products = new  productModel();      if (isset($id)){          $data = $products->updateProduct($id);          $modal = '';          if ($data){              foreach ($data as $row){                  $productName = $row['ProductName'];                  $image = $row['image'];                  $price = $row['Price'];                  $id = $row['product_Id'];                 $modal .= '                   <div class="modal fade" id="modalUpdate_'.$id.'" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">                    <div class="modal-dialog modal-dialog-centered modal-lg">                        <div class="modal-content">                            <div class="modal-header">                                <h6 class="modal-title text-muted" id="exampleModalLabel">Update Products</h6>                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>                            </div>                            <form id="formProductUpdate" action="../controller/productController.php" method="post" class="modal-body d-flex flex-column gap-2">                                <div class="d-flex gap-5">                                    <div class="input-group mb-3">                                            <span class="input-group-text" id="addon-wrapping">                                           <i class="fa-brands text-muted fa-product-hunt"></i>                                            </span>                                        <input name="ProductNameSave" value="'.$productName.'" id="ProductName" type="text" class="form-control" placeholder="Product Name" aria-label="ProductName" aria-describedby="addon-wrapping">                                    </div>                                </div>                                     <input name="imageName" type="hidden" value="'.$image.'">                                     <input name="id" type="hidden" value="'.$id.'">                                <div class="d-flex gap-5">                                    <div class="input-group mb-3">                                        <span class="input-group-text text-muted">₱</span>                                        <span class="input-group-text text-muted">0.00</span>                                        <input value="'.$price.'" name="unitPriceSave" id="unit_price" type="number" class="form-control"  placeholder="Unit Price" aria-label="Dollar amount (with dot and two decimal places)">                                    </div>                                </div>                                                <div>                                    <input name="imageFile" class="form-control" type="file">                                </div>                                <div class="modal-footer">                                    <button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal">Close</button>                                    <button style="background-color:  #4361ee" type="submit" class="btn text-light">                                       Save                                    </button>                                </div>                            </form>                        </div>                    </div>                </div>                 ';              }              echo $modal;          }      }  }  public function SaveProduct()  {      $productName = $_POST['ProductNameSave'];      $price = $_POST['unitPriceSave'];      $image = $_POST['imageName'];      $inputFile = $_FILES['imageFile'];      $id = $_POST['id'];      $model = new productModel();      if (!empty($inputFile['name'])){          $fileName = $inputFile['name'];          // Set file directory and path          $fileDir = '../../ProductImages/';          $filePath = $fileDir . $fileName;          move_uploaded_file($inputFile['tmp_name'], $filePath);          $model->saveProduct($productName,$price,$fileName,$id);      }else{          $model->saveProduct($productName,$price,$image,$id);      }  }  public function archiveProduct()  {      $id  =$_POST['id'];      $model = new productModel();      if (isset($id)){          $model->archiveProducts($id);      }else{          echo json_encode(['success' => false,'message' => 'No Id Probated']);      }  }  public function showProductUsingCategory()  {      $categoryName = $_POST['categoryName'];      $product = new productModel();      if (isset($categoryName)){        $data = $product->showProductBaseInCategory($categoryName);        if ($data){            $card = '';            foreach ($data as $row){                $productName = $row['ProductName'];                $price = $row['Price'];                $image = $row['image'];                $productId = $row['product_Id'];                $card .= '                  <form id="cart_form" action="../controller/cartController.php" method="post" class="card border-3 border-black col-lg-3 col-md-7 p-2">                   <img style="height: 30vh; object-fit: cover" class="card-img" src="../../ProductImages/'.$image.'" alt="image">                 <div class="card-body d-flex flex-column gap-2">                  <h5 class="card-title fw-bold">'.$productName.'</h5>                   <label for="quantity">                   <input name="quantity" min="1" class="form-control" type="number" value="1" placeholder="Quantity">                 </label>                   <input name="price" type="hidden" value="'.$price.'">                  <input name="image" type="hidden" value="'.$image.'">                  <input name="ProductName"  type="hidden" value="'.$productName.'">                  <input name="ProductId"  type="hidden" value="'.$productId.'">                  <input name="userId" type="hidden" value="'.$_SESSION['userId'].'">                               <h5 class="">₱'.$price.'</h5>                <button value="'.$productId.'" type="submit" class="btn btn-outline-primary">Add Cart</button>            </div>            </form>              ';            }            echo $card;        }else{            echo "<div class='alert alert-info p-2'>No Product Available</div>";        }       }else{          echo "No Category Name Probated</h1>";      }  }  public function showCount()  {      $count = new productModel();       $counted =  $count->countProduct();      echo "<h2 class='fw-bold'>$counted</h2>";  }}if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['action'])){    $controller = new productController();    switch ($_POST['action']){        case 'addProduct':            $controller->HandleAddProducts();            break;        case 'update':            $controller->updateProduct();            break;        case 'Save':            $controller->SaveProduct();            break;        case 'archive':            $controller->archiveProduct();            break;    }}if (isset($_POST['action']) && $_POST['action'] === 'showUsingCategory') {    session_start(); // Start the session at the beginning of the file    $controller = new productController();    $controller->showProductUsingCategory();}