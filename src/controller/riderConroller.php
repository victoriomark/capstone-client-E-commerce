<?phpnamespace controller;use model\riderModel;include_once '../model/riderModel.php';class riderConroller{  public function displayListOrder()  {      $orders = new riderModel();      $data = $orders->displayListOrder();      $tr = '';      if ($data){          foreach ($data as $row){              $costumerName = $row['CostumerName'];              $address = $row['Address'];              $email = $row['Email'];              $phone= $row['PhoneNumber'];              $tr .='               <tr>                <td>'.$costumerName.'</td>                <td>'.$address.'</td>                 <td>'.$phone.'</td>                <td>                <button id="btn_view" value="'.$email.'" class="btn btn-primary badge" type="button">                 view                </button>              </td>              </tr>              ';          }          echo $tr;      }else{          echo "<h3>No Delivery Assign</h3>";      }  }  public function displayOrdersDetails()  {     $email = $_POST['email'];    $orderDetails = new riderModel();    $data =  $orderDetails->displayOrdersDetails($email);    $modal = '';    if ($data){        $modal .='      <div class="modal fade" id="DetailsModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">      <form id="formDrop" action="../controller/riderConroller.php" method="post" class="modal-dialog modal-dialog-centered">        <div class="modal-content">          <div class="modal-header">            <h1 class="modal-title  fs-6 text-muted" id="exampleModalLabel">Order Details</h1>            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>          </div>          <div class="modal-body">          <table class="table table-borderless table-responsive-sm">           <thead>            <tr>              <th scope="col">Product Name</th>               <th scope="col">Quantity</th>                <th scope="col">Total</th>                 </tr>                </thead>              <tbody>        ';        $total = 0;        foreach ($data as $row){            $amount = $row['OrderAmount'];            $total += $amount ;            $modal .= '                <tr>                    <td>' . htmlspecialchars($row['ProductName']) . '</td>                    <td>' . htmlspecialchars($row['quantity']) . '</td>                    <td>' . htmlspecialchars($row['OrderAmount']) . '</td>                </tr>';        }        $modal .= '                <tr class="badge bg-secondary">                    <td colspan="2"><strong>Total:</strong></td>                    <td><strong >'.number_format($total, 2) . '</strong></td>                </tr>';        $modal .= '                        </tbody>                    </table>                    <label for="file">                      <input  name="fileUpload" type="file" accept="image/jpeg,image/png" class="form-control" alt="">                    </label>                    <input name="email" type="hidden" value="'.$email.'"  >                </div>                <div class="modal-footer">                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>                    <button  type="submit" class="btn btn-danger">Drop Off</button>                </div>            </div>        </div>    </div>';      echo $modal;    }  }    public function dropOff()    {        $email = $_POST['email'];        $file = $_FILES['fileUpload'];        $drop = new riderModel();        if (!empty($file['name'])) {            $fileName = $file['name'];            // Set file directory and path            $fileDir = '../../proofUploaded/';            $filePath = $fileDir . $fileName;            move_uploaded_file($file['tmp_name'], $filePath);            $drop->dropOff($email, $fileName);        } else {            echo json_encode(['success' => false, 'message' => 'please upload proof']);        }    }    public function storeRiderCredential()    {        $userName = $_POST['username'];        $password = $_POST['password'];        $rider = new riderModel();        if (empty($userName) && empty($password)){            echo json_encode(['success' => false , 'message' => 'please enter username and password']);        }else{            $rider->storeCredentials($userName,$password);        }    }    public function showAllRider()    {        $rider = new riderModel();        $data = $rider->showCredentialAll();        $tr = '';        if ($data){            foreach ($data as $row){                $username = $row['username'];                $riderId = $row['id'];                $tr .='                    <tr>                     <th>'.$riderId.'</th>                     <td>'.$username.'</td>                      <td>                       <button id="ntn_updateRider" value="'.$riderId.'" class="btn btn-primary">update</button>                       <button id="riderRemove" value="'.$riderId.'" class="btn btn-danger">remove</button>                     </td>                   </tr>                ';            }            echo $tr;        }    }    public function showRiderBaseOnId()    {        $id = $_POST['id'];        $rider = new riderModel();        $moda = '';        if (isset($id)){            $data = $rider->showRiderBaseOnId($id);            if ($data){                foreach ($data as $row){                    $username = $row['username'];                    $password = $row['password'];                    $riderId = $row['id'];                    $moda .= '                <div class="modal fade" id="updateModalRider_'.$riderId.'" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">                <div id="updateRiderForm" class="modal-dialog modal-dialog-centered">                    <div class="modal-content">                        <div class="modal-header">                            <h1 class="modal-title fs-6 text-muted text-muted" id="exampleModalLabel">Rider Credential</h1>                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>                        </div>                        <form id="formRiderUpdate" action="../controller/riderConroller.php" method="post"  class="modal-body d-flex flex-column gap-2">                                        <div class="form-floating mb-3">                                <input name="username" value="'.$username.'" type="email" class="form-control"  placeholder="username">                                <label for="floatingInput">Email address</label>                            </div>                            <div class="form-floating">                                <input name="NewPassword" type="password" class="form-control" placeholder="New Password">                                <label for="floatingPassword">Password</label>                            </div>                            <input name="currentPassword" type="hidden" value="'.$password.'" >                             <input name="id" type="hidden"  value="'.$riderId.'">                            <div class="modal-footer">                                <button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal">Close</button>                                <button style="background-color:  #4361ee" type="submit" class="btn text-light">                                    <i class="fa-solid fa-plus"></i>                                    Save Changes                                </button>                            </div>                        </form>                    </div>                </div>            </div>                ';                }                echo $moda;            }        }else{            echo "No Id";        }    }    public function updateRider()    {        $riderId = $_POST['id'];        $userName =$_POST['username'];        $currentPassword = $_POST['currentPassword'];        $newPassword = $_POST['NewPassword'];        $newPasswordHashed = password_hash($newPassword,PASSWORD_BCRYPT);        $rider = new riderModel();        if (empty($newPassword)){            $rider->updateRiderCredential($userName,$currentPassword,$riderId);        }else{            $rider->updateRiderCredential($userName,$newPasswordHashed,$riderId);        }    }    public function removeRider()    {        $id = $_POST['id'];        $rider = new riderModel();        if (isset($id)){            $rider->removeRiderBaseOnId($id);        }    }}if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['action'])){    $controller = new riderConroller();    switch ($_POST['action']){        case 'order':            $controller->displayOrdersDetails();            break;        case 'drop':            $controller->dropOff();            break;        case 'storeRider':            $controller->storeRiderCredential();            break;        case 'showRiderBaseOnId':            $controller->showRiderBaseOnId();            break;        case 'SaveRiderInfo':            $controller->updateRider();            break;        case 'removeRider':            $controller->removeRider();            break;    }}